<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily AI News – 改良版</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header with title and persona toggle -->
    <header class="header">
        <div class="container">
            <h1>Daily AI News</h1>
            <p>X記事とRSS記事をまとめた最新AIニュース</p>
            <!-- Persona toggle integrated in header -->
            <div class="persona-toggle">
                <button class="active" data-persona="engineer">技術者向け</button>
                <button data-persona="business">ビジネス向け</button>
            </div>
        </div>
    </header>

    <!-- Summary statistics -->
    <section class="stats">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="stat-total">0</div>
                    <div class="stat-label">記事数</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="stat-avg-score">0%</div>
                    <div class="stat-label">平均スコア</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="stat-tier1">0</div>
                    <div class="stat-label">高信頼ソース</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Filter panel -->
    <section class="filters">
        <div class="container">
            <div class="filter-group">
                <div class="filter-item">
                    <label for="source-tier-filter">ソース種別</label>
                    <select id="source-tier-filter">
                        <option value="all">すべて</option>
                        <option value="1">高信頼ソース</option>
                        <option value="2">一般ソース</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label for="min-score-filter">最低スコア</label>
                    <input type="range" id="min-score-filter" min="0" max="1" step="0.1" value="0" />
                </div>
                <div class="filter-item">
                    <input id="search-input" type="text" placeholder="キーワードで検索…" />
                </div>
            </div>
        </div>
    </section>

    <!-- Articles container -->
    <main>
        <div class="container">
            <div class="articles-grid" id="articles-container"></div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">© 2025 Daily AI News – 改良版</div>
    </footer>

    <script>
        // Persona-specific metric labels
        const metricLabels = {
            engineer: ['技術的新規性', '実装可能性', '再現性', '実務寄与', '学習価値'],
            business: ['事業影響度', '投資判断材料', '戦略的価値', '実現可能性', 'リスク評価']
        };

        const breakdownOrder = {
            engineer: ['temporal', 'relevance', 'trust', 'quality', 'actionability'],
            business: ['quality', 'relevance', 'trust', 'temporal', 'actionability']
        };

        // Sample articles data
        const articles = [
            {
                id: "demo-001",
                title: "OpenAI GPT-4 Turbo: Enhanced Performance and Reduced Costs",
                url: "https://openai.com/index/gpt-4-turbo/",
                source: "OpenAI",
                source_tier: 1,
                published_date: "2024-11-06",
                content: "OpenAI has released GPT-4 Turbo, featuring improved instruction following, JSON mode, reproducible outputs, and updated knowledge cutoff. The model offers enhanced performance at reduced costs, making advanced AI more accessible.",
                summary_note: "※ 英語記事を日本語要約：OpenAI GPT-4 Turboの性能向上とコスト削減について",
                evaluation: {
                    engineer: {
                        total_score: 0.92,
                        breakdown: { quality: 0.95, relevance: 0.90, temporal: 0.88, trust: 0.98, actionability: 0.89 },
                        recommendation: "must_read"
                    },
                    business: {
                        total_score: 0.88,
                        breakdown: { quality: 0.95, relevance: 0.85, temporal: 0.88, trust: 0.98, actionability: 0.74 },
                        recommendation: "recommended"
                    }
                }
            },
            {
                id: "demo-002",
                title: "Meta Llama 2: Open Source Large Language Model", 
                url: "https://llama.meta.com/",
                source: "Meta AI",
                source_tier: 1,
                published_date: "2024-11-05",
                content: "Meta has released Llama 2, a collection of foundation language models ranging from 7B to 70B parameters. Trained on 2 trillion tokens, these models outperform other open source language models on most benchmarks.",
                summary_note: "※ 英語記事を日本語要約：Meta Llama 2オープンソース大規模言語モデルのリリース",
                evaluation: {
                    engineer: {
                        total_score: 0.89,
                        breakdown: { quality: 0.92, relevance: 0.88, temporal: 0.85, trust: 0.95, actionability: 0.85 },
                        recommendation: "recommended"
                    },
                    business: {
                        total_score: 0.82,
                        breakdown: { quality: 0.92, relevance: 0.78, temporal: 0.85, trust: 0.95, actionability: 0.60 },
                        recommendation: "recommended"
                    }
                }
            },
            {
                id: "demo-003",
                title: "CursorとClaude Codeを使ったFigmaプラグインの開発について書きました",
                url: "https://note.com/shingo2000/n/n8550f5361d89",
                source: "X(@shingo2000)",
                source_tier: 2,
                published_date: "2024-11-04",
                content: "CursorとClaude Codeを使ったFigmaプラグインの開発について書きました。今までCursorを使ったAIコーディングをしていましたが、Claude Codeを導入して自分でコードを書く機会がほとんど無くなった感じです。",
                evaluation: {
                    engineer: {
                        total_score: 0.75,
                        breakdown: { quality: 0.70, relevance: 0.85, temporal: 0.88, trust: 0.65, actionability: 0.75 },
                        recommendation: "recommended"
                    },
                    business: {
                        total_score: 0.62,
                        breakdown: { quality: 0.70, relevance: 0.55, temporal: 0.88, trust: 0.65, actionability: 0.45 },
                        recommendation: "consider"
                    }
                }
            },
            {
                id: "demo-004", 
                title: "[R] routers to foundation models?",
                url: "https://www.reddit.com/r/MachineLearning/comments/1myj9jk/r_routers_to_foundation_models/",
                source: "Reddit MachineLearning",
                source_tier: 1,
                published_date: "2024-11-03",
                content: "AI・技術分野に関するrouters to foundation modelsについての議論。最新の動向や技術開発について。",
                evaluation: {
                    engineer: {
                        total_score: 0.58,
                        breakdown: { quality: 0.44, relevance: 0.72, temporal: 0.66, trust: 0.60, actionability: 0.48 },
                        recommendation: "consider"
                    },
                    business: {
                        total_score: 0.35,
                        breakdown: { quality: 0.44, relevance: 0.25, temporal: 0.66, trust: 0.60, actionability: 0.28 },
                        recommendation: "skip"
                    }
                }
            }
        ];

        let currentPersona = 'engineer';
        let filteredArticles = [...articles];

        // Initialize the application
        function init() {
            renderArticles();
            updateStats();
            setupEventListeners();
        }

        function setupEventListeners() {
            // Persona toggle buttons
            document.querySelectorAll('.persona-toggle button').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.persona-toggle button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentPersona = btn.dataset.persona;
                    renderArticles();
                    updateStats();
                });
            });

            // Article persona toggle buttons
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('persona-btn')) {
                    const card = e.target.closest('.article-card');
                    const articleId = card.dataset.id;
                    const persona = e.target.dataset.persona;
                    
                    // Update active button
                    card.querySelectorAll('.persona-btn').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    // Update evaluation display
                    updateArticleEvaluation(card, articleId, persona);
                }
            });

            // Filter controls
            document.getElementById('source-tier-filter').addEventListener('change', applyFilters);
            document.getElementById('min-score-filter').addEventListener('input', applyFilters);
            document.getElementById('search-input').addEventListener('input', applyFilters);
        }

        function applyFilters() {
            const tierFilter = document.getElementById('source-tier-filter').value;
            const minScore = parseFloat(document.getElementById('min-score-filter').value);
            const searchTerm = document.getElementById('search-input').value.toLowerCase();

            filteredArticles = articles.filter(article => {
                const tierMatch = tierFilter === 'all' || article.source_tier.toString() === tierFilter;
                const scoreMatch = article.evaluation[currentPersona].total_score >= minScore;
                const searchMatch = !searchTerm || 
                    article.title.toLowerCase().includes(searchTerm) ||
                    article.content.toLowerCase().includes(searchTerm);
                
                return tierMatch && scoreMatch && searchMatch;
            });

            renderArticles();
            updateStats();
        }

        function renderArticles() {
            const container = document.getElementById('articles-container');
            
            // Sort by evaluation score descending
            const sortedArticles = [...filteredArticles].sort((a, b) => 
                b.evaluation[currentPersona].total_score - a.evaluation[currentPersona].total_score
            );

            container.innerHTML = sortedArticles.map(article => {
                const eval_data = article.evaluation[currentPersona];
                const otherPersona = currentPersona === 'engineer' ? 'business' : 'engineer';
                const otherEval = article.evaluation[otherPersona];

                return `
                    <div class="article-card" data-id="${article.id}">
                        <div class="article-header">
                            <h2 class="article-title">
                                <a href="${article.url}" target="_blank">${article.title}</a>
                            </h2>
                            <div class="article-meta">
                                <span class="source tier-${article.source_tier}">${article.source}</span>
                                <span class="date">${article.published_date}</span>
                            </div>
                        </div>
                        <div class="article-content">${article.content}</div>
                        ${article.summary_note ? `<div class="summary-note">${article.summary_note}</div>` : ''}
                        
                        <div class="evaluation-panel">
                            <div class="score-display">
                                <div class="total-score">${Math.round(eval_data.total_score * 100)}%</div>
                                <div class="persona-toggle">
                                    <button class="persona-btn ${currentPersona === 'engineer' ? 'active' : ''}" data-persona="engineer">技術者</button>
                                    <button class="persona-btn ${currentPersona === 'business' ? 'active' : ''}" data-persona="business">ビジネス</button>
                                </div>
                            </div>
                            
                            <div class="score-breakdown">
                                ${breakdownOrder[currentPersona].map((key, i) => `
                                    <div class="score-item">
                                        <div class="score-value">${Math.round(eval_data.breakdown[key] * 100)}</div>
                                        <div class="score-label">${metricLabels[currentPersona][i]}</div>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div class="recommendation rec-${eval_data.recommendation}">
                                ${getRecommendationText(eval_data.recommendation)}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateArticleEvaluation(card, articleId, persona) {
            const article = articles.find(a => a.id === articleId);
            if (!article) return;

            const eval_data = article.evaluation[persona];
            
            // Update total score
            card.querySelector('.total-score').textContent = Math.round(eval_data.total_score * 100) + '%';
            
            // Update breakdown scores
            const breakdown = card.querySelector('.score-breakdown');
            breakdown.innerHTML = breakdownOrder[persona].map((key, i) => `
                <div class="score-item">
                    <div class="score-value">${Math.round(eval_data.breakdown[key] * 100)}</div>
                    <div class="score-label">${metricLabels[persona][i]}</div>
                </div>
            `).join('');
            
            // Update recommendation
            const recommendation = card.querySelector('.recommendation');
            recommendation.className = `recommendation rec-${eval_data.recommendation}`;
            recommendation.textContent = getRecommendationText(eval_data.recommendation);
        }

        function getRecommendationText(rec) {
            const texts = {
                must_read: 'MUST READ',
                recommended: 'RECOMMENDED', 
                consider: 'CONSIDER',
                skip: 'SKIP'
            };
            return texts[rec] || rec;
        }

        function updateStats() {
            document.getElementById('stat-total').textContent = filteredArticles.length;
            
            const avgScore = filteredArticles.length > 0 
                ? filteredArticles.reduce((sum, article) => sum + article.evaluation[currentPersona].total_score, 0) / filteredArticles.length
                : 0;
            document.getElementById('stat-avg-score').textContent = Math.round(avgScore * 100) + '%';
            
            const tier1Count = filteredArticles.filter(article => article.source_tier === 1).length;
            document.getElementById('stat-tier1').textContent = tier1Count;
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>